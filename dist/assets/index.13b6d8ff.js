import{r as c,ax as ie,u as ue,b as he,R as pe,U as me,X as fe,a6 as we,a7 as P,c as o,C as Ee,ay as ye,j as a,T as r,Z as d,p as $,az as _e,aA as Se,aB as ke,aC as Ce,aD as y,y as Q,aE as ve,F as b,J as F,ak as I,aF as xe,aG as be,aH as Fe,aI as Be,am as Ne,a9 as Y,a8 as Te,O as Ae,aJ as Ie,aK as De,aL as ze,aM as D,ar as z,aN as q,aO as E,at as Oe,au as Le,av as G,aw as J,aP as U,aQ as ge,aR as Re,aS as We,a5 as O,aT as K}from"./index.2cdbdff1.js";const $e=()=>{var M;const[t,p]=c.exports.useState(1),[l,L]=c.exports.useState(!1),[X,B]=c.exports.useState(!1),[i,m]=c.exports.useState(!1),[e,Z]=c.exports.useState(void 0),[g,R]=c.exports.useState(""),[V,ee]=c.exports.useState(e==null?void 0:e.amount_out_balance),[_,Me]=c.exports.useState(""),{connect:ae}=c.exports.useContext(ie),[oe,S]=c.exports.useState(!1),[te,N]=c.exports.useState(!1);let{id:ne}=ue();const W=he(),{account:s,chainId:w,library:f}=pe();c.exports.useEffect(()=>{re()},[]),c.exports.useEffect(()=>{s&&e&&se()},[s,e]);const re=async()=>{try{L(!0);const{data:{listing:n}}=await me.get(`${fe}/lists/${ne}`);L(!1),Z(n),p(n.status),ee(n.amount_out_balance)}catch(n){console.log({error84:n})}},se=async()=>{var u;const n=await we((u=e==null?void 0:e.token_in_metadata)==null?void 0:u.address,f,w,s);if(R(P(n.toString())),P(n.toString())>=(e==null?void 0:e.amount_in)){let h=Number(e==null?void 0:e.status)<2?2:e==null?void 0:e.status;p(h)}},j=async()=>{var n,u;try{m(!0);const h=await Oe((n=e==null?void 0:e.token_in_metadata)==null?void 0:n.address,f,w),k=await Le((u=e==null?void 0:e.token_in_metadata)==null?void 0:u.address,f,w,h.toString());p(2),R(e==null?void 0:e.amount_in),G(`${e==null?void 0:e.amount_in} ${e==null?void 0:e.token_in_metadata.symbol} approved`)}catch(h){if(h===void 0)return;J.error("Opps, something went wrong!",{position:J.POSITION.TOP_RIGHT})}finally{m(!1)}},ce=async n=>{const u=e!=null&&e.is_friction?n.amount_out:e==null?void 0:e.amount_in,h=e!=null&&e.is_friction?n.amount_in:e==null?void 0:e.amount_out_balance;let k={...e};try{m(!0);let C={signatory:s,receivingWallet:s,tokenIn:e==null?void 0:e.token_out,tokenOut:e==null?void 0:e.token_in,amountOut:new U(u).shiftedBy(e==null?void 0:e.token_in_metadata.decimal_place).toString(),amountIn:new U(h).shiftedBy(e==null?void 0:e.token_out_metadata.decimal_place).toString(),deadline:e==null?void 0:e.deadline,nonce:e==null?void 0:e.nonce_friction};k.aIn=u,k.aOut=h;const le=f==null?void 0:f.getSigner(),{signature:T}=await ge(le,C,w),H=await Re(f,w,e==null?void 0:e.signature,T,k,s);let v;if(We(w)){const x=setInterval(async()=>{m(!0);const{data:A}=await O.checkRelayStatus(H.taskId);if(A.task.taskState=="ExecSuccess"){v=A.task.transactionHash;const de={buyerSignature:T,sellerSignature:e==null?void 0:e.signature,id:e==null?void 0:e._id,account:s,transactionHash:v,amount:e!=null&&e.is_friction?n.amount_in:e==null?void 0:e.amount_out};await O.upDateListComp(de),p(3),G("Swap Successful"),m(!1),clearInterval(x)}else A.task.taskState=="Cancelled"&&(m(!1),clearInterval(x),K("Swap Not successful. Please try again or contact us"))},5e3)}else{v=H.transactionHash;const x={buyerSignature:T,sellerSignature:e==null?void 0:e.signature,id:e==null?void 0:e._id,account:s,transactionHash:v,amount:e!=null&&e.is_friction?n.amount_in:e==null?void 0:e.amount_out};await O.upDateListComp(x),m(!1)}}catch(C){_.status&&_.status==401?p(3):K(C.reason||C.message)}finally{}};return o(Ee,{children:[o(ye,{children:[a(r,{className:"header",as:"h2",uppercase:!0,size:"s3",color:"#453953;",weight:"700",children:"Transaction Queue"}),a(d,{height:20}),l?a("span",{children:"Loading"}):o($,{children:[o(_e,{justify:"space-between",children:[a(Se,{onClick:()=>W("/"),children:o("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"#BEFECD",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[a("line",{x1:"19",y1:"12",x2:"5",y2:"12"}),a("polyline",{points:"12 19 5 12 12 5"})]})}),o(ke,{direction:"column",justify:"space-between",children:[o(Ce,{children:[o(y,{children:[s?a(r,{color:"#fff",size:"s1",children:Q(s||"",9,"***")}):a(r,{color:"#fff",size:"s1",children:"Wallet not connected"}),a(r,{weight:"500",size:"tiny",color:`#E8E6EA;\r
`,children:"Wallet Id"})]}),a(d,{height:26}),o(y,{children:[a(r,{size:"s3",color:"#E8E6EA",uppercase:!0,children:"You give"}),o(r,{size:"s1",color:"#fff",children:[e==null?void 0:e.amount_in," ",e==null?void 0:e.token_in_metadata.symbol]}),a(r,{size:"s2",color:"#E8E6EA",children:"(Escrow fee : 0.125%)"})]})]}),a(d,{height:70}),o(ve,{children:[a(y,{children:o(r,{as:"div",color:"#E8E6EA",size:"s1",uppercase:!0,children:["NB:"," ",a("div",{onClick:()=>B(!0),style:{textDecoration:"underline",display:"inline-block"},children:"Escrow"})," ","Fee Applies"]})}),a(d,{height:24}),a("span",{className:"error",children:_}),s&&t<3?a(b,{className:"",children:Number(g)<(e==null?void 0:e.amount_in)?a(F,{classNames:"",onClick:()=>j(),text:"Approve",loading:l||i,disabled:l||i}):a(b,{gap:8,children:a(F,{classNames:"secondary",onClick:()=>N(!0),text:"Swap",loading:l||i,disabled:l||i||!!_})})}):!s&&a(I,{className:"secondary",onClick:()=>S(!0),children:"Connect"})]})]}),je(t,e==null?void 0:e.amount_in,(M=e==null?void 0:e.token_in_metadata)==null?void 0:M.symbol),o(xe,{direction:"column",justify:"space-between",align:"flex-end",children:[o(be,{children:[o(y,{children:[a(r,{color:"#fff",size:"s1",children:Q((e==null?void 0:e.receiving_wallet)||"",9,"***")}),a(r,{color:" #E8E6EA",size:"tiny",children:"Wallet Id"})]}),a(d,{height:26}),o(y,{children:[a(r,{size:"s3",color:" #E8E6EA",uppercase:!0,children:"You get"}),o(r,{color:"#fff",size:"s1",children:[e==null?void 0:e.amount_out," ",e==null?void 0:e.token_out_metadata.symbol]}),a(r,{color:"#E8E6EA",size:"tiny",children:"(Escrow fee : 0.125%)"})]})]}),a(d,{height:113})]})]}),a(Fe,{children:a("div",{className:"inner",children:s&&t<3?o($,{children:[Number(g)<(e==null?void 0:e.amount_in)?a(F,{classNames:"secondary",onClick:()=>j(),text:"Approve",loading:l||i,disabled:l||i}):a(b,{gap:8,children:a(F,{classNames:"secondary",onClick:()=>N(!0),text:"Swap",loading:l||i,disabled:l||i})}),a(d,{width:41}),a(I,{className:"",onClick:()=>W("/"),children:"Cancel"})]}):!s&&a(I,{className:"secondary",onClick:()=>S(!0),children:"Connect"})})}),a(d,{height:24}),o(Be,{children:[o(b,{align:"end",justify:"center",children:[a(Ne,{}),a(d,{width:24}),a(r,{style:{top:"-12px",position:"relative"},size:"s1",uppercase:!0,color:"#FFFFFF",children:"Thanks for trading with us"})]}),a(d,{height:47}),a(Y,{style:{flexDirection:"column"},children:a(r,{size:"s2",weight:"300",color:"#E8E6EA",children:"Your money is safe in our Escrow"})})]})]})]}),a(d,{height:20}),a(Te,{children:a(Y,{children:o(r,{as:"div",weight:"700",size:"s1",children:["NB:"," ",a("div",{onClick:()=>B(!0),style:{display:"inline-block",cursor:"pointer",textDecoration:"underline"},children:"Escrow"})," ","Fee Applies"]})})}),a(Ae,{show:X,handleClose:()=>B(!1),headerText:"Escrow Fee",type:"info",msg:"Escrow Fee is a trading fee we charge to guarantee you a secured transaction. We charge from both parties to safe guard token transactions. Our fee\u2019s are not more than 0.125% per trade. If trades are cancelled at any point in the transaction queue, we would refund all payments inclusive of the Escrow Fee. We provide this feature on all token and coin transactions on our platform. If you have anymore questions please reach us on our email support@vetme.com or via our telegram platform. Thanks for trading with us."}),a(Ie,{show:oe,connect:n=>{S(!1),ae(n)},handleClose:()=>S(!1)}),e&&a(De,{trade:e,handleClose:()=>N(!1),show:te,amount:V,handleSwap:n=>ce(n)})]})},je=(t,p,l)=>o(ze,{status:t,children:[a(D,{className:t>=1?"active":"",leftMsg:t>=1?"Transaction  Opened":"",rightMsg:t>=1?"Transaction  Opened":"",children:a(z,{color:t>=1?"#BEFECD":""})}),o(q,{children:[a(E,{color:t>=2?"#BEFECD":""}),a(E,{color:t>=2?"#BEFECD":""}),a(E,{color:t>=2?"#BEFECD":""})]}),a(D,{className:t>=2?"active":"",leftMsg:t>=2?`Approved ${p}${l}`:"",children:a(z,{color:t>=2?"#BEFECD":""})}),o(q,{children:[a(E,{color:t>=3?"#BEFECD":""}),a(E,{color:t>=3?"#BEFECD":""}),a(E,{color:t>=3?"#BEFECD":""})]}),a(D,{className:t>=3?"active":"",leftMsg:t>=3?"Deal Completed":"",children:a(z,{color:t>=3?"#BEFECD":""})})]});export{$e as default};
